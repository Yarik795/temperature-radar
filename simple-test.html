<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –≥—Ä–∞—Ñ–∏–∫–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        #chart { width: 600px; height: 600px; border: 3px solid #333; margin: 20px auto; background: white; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>üß™ –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã</h1>
        
        <div id="status"></div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button onclick="testD3()">–¢–µ—Å—Ç D3.js</button>
            <button onclick="testCSV()">–¢–µ—Å—Ç CSV</button>
            <button onclick="createSimpleChart()">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é –¥–∏–∞–≥—Ä–∞–º–º—É</button>
            <button onclick="createTemperatureChart()">–°–æ–∑–¥–∞—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—É—é –¥–∏–∞–≥—Ä–∞–º–º—É</button>
        </div>
        
        <div id="chart"></div>
        
        <div id="log" style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        let logElement;
        
        function log(message, type = 'info') {
            if (!logElement) logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            logEntry.className = type;
            logElement.appendChild(logEntry);
            console.log(message);
        }
        
        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ D3.js
        function testD3() {
            log('üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º D3.js...');
            
            if (typeof d3 === 'undefined') {
                updateStatus('‚ùå D3.js –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω!', 'error');
                log('‚ùå D3.js –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
                return false;
            }
            
            updateStatus(`‚úÖ D3.js –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ! –í–µ—Ä—Å–∏—è: ${d3.version}`, 'success');
            log(`‚úÖ D3.js –≤–µ—Ä—Å–∏—è: ${d3.version}`);
            return true;
        }
        
        // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ CSV
        async function testCSV() {
            log('üì• –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É CSV...');
            
            try {
                const response = await fetch('dataexport_20250813T194724.csv');
                if (response.ok) {
                    const csvText = await response.text();
                    const lines = csvText.split('\n');
                    const dataLines = lines.slice(10).filter(line => line.trim() && line.includes(','));
                    
                    updateStatus(`‚úÖ CSV –∑–∞–≥—Ä—É–∂–µ–Ω! –°—Ç—Ä–æ–∫: ${lines.length}, –î–∞–Ω–Ω—ã—Ö: ${dataLines.length}`, 'success');
                    log(`‚úÖ CSV –∑–∞–≥—Ä—É–∂–µ–Ω: ${dataLines.length} —Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö`);
                    log(`üìä –ü–µ—Ä–≤—ã–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã: ${dataLines.slice(0, 5).map(line => line.split(',')[1]).join(', ')}`);
                    return true;
                } else {
                    updateStatus(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV: ${response.status}`, 'error');
                    log(`‚ùå –û—à–∏–±–∫–∞ CSV: ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                log(`‚ùå –û—à–∏–±–∫–∞ CSV: ${error.message}`, 'error');
                return false;
            }
        }
        
        // –¢–µ—Å—Ç 3: –ü—Ä–æ—Å—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
        function createSimpleChart() {
            log('üé® –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –¥–∏–∞–≥—Ä–∞–º–º—É...');
            
            if (!testD3()) return;
            
            const chart = document.getElementById('chart');
            chart.innerHTML = '';
            
            const svg = d3.select('#chart')
                .append('svg')
                .attr('width', 600)
                .attr('height', 600);
            
            // –†–∏—Å—É–µ–º –∫—Ä—É–≥
            svg.append('circle')
                .attr('cx', 300)
                .attr('cy', 300)
                .attr('r', 200)
                .attr('fill', '#ff6b6b')
                .attr('stroke', '#333')
                .attr('stroke-width', 5);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
            svg.append('text')
                .attr('x', 300)
                .attr('y', 310)
                .attr('text-anchor', 'middle')
                .attr('fill', 'white')
                .attr('font-size', '24px')
                .attr('font-weight', 'bold')
                .text('D3.js —Ä–∞–±–æ—Ç–∞–µ—Ç!');
            
            updateStatus('‚úÖ –ü—Ä–æ—Å—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
            log('‚úÖ –ü—Ä–æ—Å—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–Ω–∞');
        }
        
        // –¢–µ—Å—Ç 4: –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
        async function createTemperatureChart() {
            log('üå°Ô∏è –°–æ–∑–¥–∞–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—É—é –¥–∏–∞–≥—Ä–∞–º–º—É...');
            
            if (!testD3()) return;
            if (!(await testCSV())) return;
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                const response = await fetch('dataexport_20250813T194724.csv');
                const csvText = await response.text();
                const lines = csvText.split('\n');
                
                // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 100 –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Ç–µ—Å—Ç–∞)
                const data = [];
                for (let i = 10; i < Math.min(110, lines.length); i++) {
                    const line = lines[i].trim();
                    if (line && line.includes(',')) {
                        const [timestamp, tempStr] = line.split(',');
                        const temperature = parseFloat(tempStr);
                        if (!isNaN(temperature)) {
                            data.push({ timestamp, temperature });
                        }
                    }
                }
                
                log(`üìä –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.length} –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Ç–µ—Å—Ç–∞`);
                
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
                const chart = document.getElementById('chart');
                chart.innerHTML = '';
                
                const svg = d3.select('#chart')
                    .append('svg')
                    .attr('width', 600)
                    .attr('height', 600);
                
                const centerX = 300;
                const centerY = 300;
                const radius = 200;
                
                // –†–∏—Å—É–µ–º —Å–µ–∫—Ç–æ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
                const angleStep = (2 * Math.PI) / data.length;
                
                data.forEach((d, i) => {
                    const startAngle = i * angleStep;
                    const endAngle = (i + 1) * angleStep;
                    
                    const x1 = centerX + Math.cos(startAngle) * radius;
                    const y1 = centerY + Math.sin(startAngle) * radius;
                    const x2 = centerX + Math.cos(endAngle) * radius;
                    const y2 = centerY + Math.sin(endAngle) * radius;
                    
                    // –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
                    const color = d.temperature > 20 ? '#ff6b6b' : 
                                 d.temperature > 10 ? '#4ecdc4' : 
                                 d.temperature > 0 ? '#45b7d1' : '#a8e6cf';
                    
                    // –†–∏—Å—É–µ–º —Å–µ–∫—Ç–æ—Ä
                    const path = d3.path();
                    path.moveTo(centerX, centerY);
                    path.lineTo(x1, y1);
                    path.arc(centerX, centerY, radius, startAngle, endAngle);
                    path.closePath();
                    
                    svg.append('path')
                        .attr('d', path())
                        .attr('fill', color)
                        .attr('stroke', '#fff')
                        .attr('stroke-width', 1)
                        .attr('opacity', 0.8);
                });
                
                // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫—Ä—É–≥
                svg.append('circle')
                    .attr('cx', centerX)
                    .attr('cy', centerY)
                    .attr('r', 50)
                    .attr('fill', '#333')
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 3);
                
                // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
                svg.append('text')
                    .attr('x', centerX)
                    .attr('y', centerY + 5)
                    .attr('text-anchor', 'middle')
                    .attr('fill', 'white')
                    .attr('font-size', '14px')
                    .attr('font-weight', 'bold')
                    .text('–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞');
                
                updateStatus(`‚úÖ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–Ω–∞! ${data.length} —Å–µ–∫—Ç–æ—Ä–æ–≤`, 'success');
                log(`‚úÖ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–Ω–∞ —Å ${data.length} —Å–µ–∫—Ç–æ—Ä–∞–º–∏`);
                
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã: ${error.message}`, 'error');
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç—ã...');
            updateStatus('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã...', 'info');
            
            setTimeout(() => {
                testD3();
                testCSV();
            }, 500);
        };
    </script>
</body>
</html>
