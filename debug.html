<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –≥—Ä–∞—Ñ–∏–∫–æ–º</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        #chart { width: 400px; height: 400px; border: 2px solid #ccc; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –≥—Ä–∞—Ñ–∏–∫–æ–º</h1>
    
    <div class="debug-section">
        <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ D3.js</h3>
        <div id="d3Status"></div>
    </div>

    <div class="debug-section">
        <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV</h3>
        <div id="csvStatus"></div>
        <button onclick="testCSV()">–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ CSV</button>
    </div>

    <div class="debug-section">
        <h3>3. –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç D3.js</h3>
        <div id="chart"></div>
        <button onclick="testD3()">–¢–µ—Å—Ç D3.js</button>
    </div>

    <div class="debug-section">
        <h3>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏</h3>
        <p>–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –æ—à–∏–±–∫–∏</p>
        <div id="consoleLog"></div>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ D3.js
        function checkD3() {
            const d3Status = document.getElementById('d3Status');
            
            if (typeof d3 !== 'undefined') {
                d3Status.innerHTML = '<div class="success">‚úÖ D3.js –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ! –í–µ—Ä—Å–∏—è: ' + d3.version + '</div>';
                console.log('D3.js –≤–µ—Ä—Å–∏—è:', d3.version);
            } else {
                d3Status.innerHTML = '<div class="error">‚ùå D3.js –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏</div>';
                console.error('D3.js –Ω–µ –Ω–∞–π–¥–µ–Ω!');
            }
        }

        // –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ CSV
        async function testCSV() {
            const csvStatus = document.getElementById('csvStatus');
            
            try {
                const response = await fetch('dataexport_20250813T194724.csv');
                if (response.ok) {
                    const csvText = await response.text();
                    const lines = csvText.split('\n');
                    const dataLines = lines.slice(10).filter(line => line.trim() && line.includes(','));
                    
                    csvStatus.innerHTML = `
                        <div class="success">
                            ‚úÖ CSV –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!<br>
                            –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: ${lines.length}<br>
                            –°—Ç—Ä–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏: ${dataLines.length}<br>
                            –ü–µ—Ä–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: ${dataLines.slice(0, 3).map(line => line.split(',')[1]).join(', ')}
                        </div>
                    `;
                    console.log('CSV –∑–∞–≥—Ä—É–∂–µ–Ω:', dataLines.length, '—Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö');
                } else {
                    csvStatus.innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV: ' + response.status + '</div>';
                }
            } catch (error) {
                csvStatus.innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</div>';
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV:', error);
            }
        }

        // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç D3.js
        function testD3() {
            if (typeof d3 === 'undefined') {
                alert('D3.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                return;
            }

            const chart = document.getElementById('chart');
            chart.innerHTML = '';

            const svg = d3.select('#chart')
                .append('svg')
                .attr('width', 400)
                .attr('height', 400);

            // –†–∏—Å—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –∫—Ä—É–≥
            svg.append('circle')
                .attr('cx', 200)
                .attr('cy', 200)
                .attr('r', 100)
                .attr('fill', '#ff6b6b')
                .attr('stroke', '#333')
                .attr('stroke-width', 3);

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
            svg.append('text')
                .attr('x', 200)
                .attr('y', 210)
                .attr('text-anchor', 'middle')
                .attr('fill', 'white')
                .attr('font-size', '16px')
                .text('D3.js —Ä–∞–±–æ—Ç–∞–µ—Ç!');

            console.log('D3.js —Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å
        function logToConsole(message, type = 'info') {
            const consoleLog = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            logEntry.className = type;
            consoleLog.appendChild(logEntry);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            logToConsole('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            checkD3();
            testCSV();
            
            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –∫–æ–Ω—Å–æ–ª–∏
            const originalError = console.error;
            console.error = function(...args) {
                logToConsole('–û–®–ò–ë–ö–ê: ' + args.join(' '), 'error');
                originalError.apply(console, args);
            };
        };
    </script>
</body>
</html>
